<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NIGHT OF LAUGHTER Upcoming Events | Buy Tickets</title>
    <style>
        body{
            font-family: Arial, sans-serif;
            background: #f2f2f2;
            color: #333;
        }
        header{
            width: 100%;
            background: #fff;
            padding: 15px 8%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: fixed;
            top:0;
            left:0;
            z-index: 100;
        }
        .header-left {
            display: flex;
            align-items: center;
        }
        .header-logo {
            height: 75px;
            width: auto;
        }
        nav {
            display: flex;
            flex-direction: row;
            gap: 8px;
        }
        nav a {
            padding: 10px 20px;
            color: #333;
            font-weight: 600;
            font-size: 16px;
            text-decoration: none;
            border-radius: 8px;
            transition: background 0.14s, color 0.15s;
        }
        nav a:hover {
            background: #eeeeee;
            color: #007bff;
        }
        .hero{
            width: 100%;
            height: 75vh;
            background: url('https://i.postimg.cc/wM34b68W/1763283904035-1.jpg') center/cover no-repeat;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 0 10%;
            margin-top: 80px;
        }
        .hero h1{
            color: #fff;
            font-size: 45px;
            margin-bottom: 10px;
            text-shadow: 0 3px 10px rgba(0,0,0,0.4);
        }
        .hero p{
            color: #eee;
            font-size: 18px;
            margin-bottom: 20px;
            text-shadow: 0 2px 6px rgba(0,0,0,0.4);
        }
        .featured, .events{
            width: 100%;
            padding: 50px 8% 0 8%;
        }
        .featured h2, .events h2{
            font-size: 28px;
            margin-bottom: 20px;
        }

        /* New Card Layout */
        .event-card {
            width: 100%;
            max-width: 380px;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            margin: 36px auto;
        }
        .event-thumb img{
            width: 100%;
            height: 300px;
            object-fit: contain;
        }
        .event-content{
            padding: 15px;
            line-height: 1.5;
        }
        .event-title{
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .info-label{
            font-weight: bold;
        }
        .price-box{
            margin-top: 8px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .btn-row{
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        .btn{
            width: 48%;
            padding: 10px;
            background: #007bff;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
            border: none;
            display: inline-block;
        }
        .btn.info{
            background: #444;
        }
        .btn:hover{
            opacity: .85;
        }
        #testimonialsSection, #contactSection {
            padding: 50px 8%;
            background: #fff;
            margin-top: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
        }
        #testimonialsSection h2, #contactSection h2 {
            font-size: 28px;
            margin-bottom: 18px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            border-radius: 15px;
            text-align: center;
            position: relative;
        }
        .ticket-banner {
            width: 100%;
            height: 180px;
            object-fit: contain;
            background: #f4f4f4;
            border-radius: 10px;
            display: block;
        }
        .btn-primary {
            background: #007bff;
            padding: 10px 20px;
            color: white;
            border-radius: 6px;
            border: none;
            margin-top: 10px;
            cursor: pointer;
            font-size: 17px;
        }
        .btn-secondary {
            background: #ddd;
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
        }
        .close {
            position: absolute;
            top: 10px;
            right: 25px;
            color: #444;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
        }
        .receipt-modal-colorful {
            box-shadow: 0 4px 25px rgba(17,118,214,0.10);
            background: #fff;
            border-radius:8px;
            margin:6px 0;
            overflow:hidden;
            border: 2px solid #1176d6;
            max-width: 340px;
            margin-left: auto;
            margin-right: auto;
        }
        .receipt-modal-colorful h3 {
            margin:0;
        }
        .receipt-modal-colorful .qr-container {
            text-align:center;
            margin-top:10px;
        }
        #ticketModal .modal-content form {
          margin: 0;
          padding: 0;
        }
        #ticketModal .field-group {
          display: flex;
          flex-direction: column;
          align-items: flex-start;
        }
        #ticketModal label {
          font-size: 15px;
          font-weight: bold;
          margin-bottom: 5px;
          color: #333;
        }
        #ticketModal input, #ticketModal select {
          width: 100%;
          padding: 10px 12px;
          border-radius: 7px;
          border: 1px solid #aaa;
          font-size: 16px;
          margin-bottom: 0px;
          background: #f9fafd;
          box-sizing: border-box;
        }
        #ticketModal input:focus, #ticketModal select:focus {
          border: 1.5px solid #1176d6;
          outline: none;
          background: #eefaff;
        }
        #ticketModal .btn-primary {
          width: 100%;
          font-size: 17px;
        }

        footer{
            background: #222;
            padding: 30px 8%;
            color: #ccc;
            text-align: center;
            margin-top: 50px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <!-- Navigation Header -->
    <header>
        <div class="header-left">
            <img src="logo.png" alt="Night of Laughter Logo" class="header-logo">
        </div>
        <nav id="navMenu">
            <a href="#featuredSection">Featured Events</a>
            <a href="#eventsSection">Upcoming Events</a>
            <a href="#testimonialsSection">Testimonials</a>
            <a href="#contactSection">Contact</a>
        </nav>
    </header>
    <!-- Hero at the Top -->
    <section class="hero">
        <div>
            <h1>NIGHT OF LAUGHTER</h1>
            <p>Instant digital tickets. No queues. No stress.</p>
        </div>
    </section>
    <!-- Featured Event(s) -->
    <section class="featured" id="featuredSection"></section>
    <!-- Upcoming Events -->
    <section class="events" id="eventsSection"></section>
    <!-- Testimonials Section -->
    <section id="testimonialsSection">
        <h2>Testimonials</h2>
        <p>Coming soon: Audiences share their NIGHT OF LAUGHTER experiences!</p>
    </section>
    <!-- Contact Section -->
    <section id="contactSection">
        <h2>Contact</h2>
        <p>Email: info@nightoflaughter.com<br>Phone: +260-978-xxx-xxx</p>
    </section>
    <!-- ================= BUY TICKET MODAL ================= -->
    <div id="ticketModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <img id="ticketBanner" src="" class="ticket-banner" />
            <h2 id="eventNameDisplay" style="margin:20px 0 10px 0;"></h2>
            <form id="ticketForm" style="display:flex;flex-direction:column;gap:14px;margin-top:12px;" onsubmit="event.preventDefault(); showConfirmModal();">
              <div class="field-group">
                <label for="buyerName">Name</label>
                <input type="text" id="buyerName" placeholder="Your Full Name" autocomplete="name" required>
              </div>
              <div class="field-group">
                <label for="buyerPhone">Phone Number</label>
                <input type="tel" id="buyerPhone" placeholder="e.g. 0971234567" autocomplete="tel" required>
              </div>
              <div class="field-group">
                <label for="ticketType">Ticket Type</label>
                <select id="ticketType">
                  <option value="VIP">VIP</option>
                  <option value="Ordinary">Ordinary</option>
                  <option value="Couple">Couple</option>
                </select>
              </div>
              <button type="submit" class="btn-primary" style="margin-top:14px;">
                Continue
              </button>
            </form>
        </div>
    </div>
    <!-- ================= CONFIRMATION MODAL ================= -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2>Confirm Your Ticket</h2>
            <div id="confirmDetails"></div>
            <button id="whatsappBookBtn" class="btn-primary">Book via WhatsApp</button>
            <button onclick="closeConfirmModal()" class="btn-secondary">Cancel</button>
        </div>
    </div>
    <!-- ================= TICKET RESULT (IMAGE DOWNLOAD) ================= -->
    <div id="ticketResult" class="modal">
        <div class="modal-content">
            <h2>Your Ticket is Ready</h2>
            <canvas id="ticketCanvas" width="400" height="600" style="border:1px solid #000"></canvas>
            <a id="downloadLink" class="btn-primary" download="ticket.png">Download Ticket</a>
        </div>
    </div>
    <footer>
        NIGHT OF LAUGHTER© 2025 • All Rights Reserved
    </footer>
    <script>
    // No hamburger nav
    // No hamburger JS required

    function toggleDescription(id) {
        var desc = document.getElementById(id);
        if(desc) {
            desc.style.display = (desc.style.display === 'block') ? 'none' : 'block';
        }
    }

    // SheetDB: expects spreadsheet columns as follows:
    // name, date, time, venue, image, vip_single, vip_double, ordinary_single, ordinary_double, desc, type
    const SHEETDB_API = "https://sheetdb.io/api/v1/owneanfeuzae9";
    let events = [];

    function loadEvents() {
      fetch(SHEETDB_API)
        .then(res => res.json())
        .then(data => {
          events = data;
          renderEvents();
        });
    }

    function renderEventCard(ev, idx, isFeatured = false) {
        const moreId = isFeatured ? "featuredDesc" : `desc_${idx}`;
        return `
        <div class="event-card">
            <div class="event-thumb">
                <img src="${ev.image || 'https://via.placeholder.com/400x200'}">
            </div>
            <div class="event-content">
                <div class="event-title">${ev.name || "Event Name"}</div>
                <div><span class="info-label">Date:</span> ${ev.date || "TBA"}</div>
                <div><span class="info-label">Time:</span> ${ev.time || "TBA"}</div>
                <div><span class="info-label">Venue:</span> ${ev.venue || "TBA"}</div>
                <div class="price-box">
                    <div><b>Prices:</b></div>
                    <div>VIP: K${ev.vip_single || "-"} (Double: K${ev.vip_double || "-"})</div>
                    <div>Ordinary: K${ev.ordinary_single || "-"} (Double: K${ev.ordinary_double || "-"})</div>
                </div>
                <div class="btn-row">
                    <button class="btn" onclick="openBuyTicket('${ev.name}','${ev.image}')">Buy Ticket</button>
                    <button class="btn info" onclick="toggleDescription('${moreId}')">More Info</button>
                </div>
                <div id="${moreId}" style="display:none;margin-top:10px;">
                  <p>${ev.desc || ""}</p>
                </div>
            </div>
        </div>`;
    }

    function renderEvents() {
        // Featured Event
        const featured = events.find(ev => ev.type && ev.type.toLowerCase().trim() === "featured");
        document.getElementById("featuredSection").innerHTML = featured 
            ? renderEventCard(featured, 0, true) : '';

        // Upcoming Events
        const upcoming = events.filter(ev => ev.type && ev.type.toLowerCase().trim() === "upcoming");
        document.getElementById("eventsSection").innerHTML =
            `<h2>Upcoming Events</h2>
            <div style="display:flex;flex-direction:column;align-items:center;gap:32px;">
            ${upcoming.map((ev, idx) => renderEventCard(ev, idx)).join('')}
            </div>`;
    }

    function openBuyTicket(eventName, image) {
        document.getElementById("ticketModal").style.display = "flex";
        document.getElementById("eventNameDisplay").textContent = eventName;
        document.getElementById("ticketBanner").src = image;
        document.getElementById("buyerName").value = "";
        document.getElementById("buyerPhone").value = "";
        document.getElementById("ticketType").value = "VIP";
        document.getElementById("ticketModal").dataset.event = eventName;
        document.getElementById("ticketModal").dataset.image = image;
        document.getElementById("buyerName").focus();
    }
    function closeModal() {
        document.getElementById("ticketModal").style.display = "none";
    }

    function generateAndDownloadTicketImage(callback) {
        let canvas = document.createElement("canvas");
        canvas.width = 400;
        canvas.height = 600;
        let ctx = canvas.getContext("2d");
        ctx.fillStyle = "#f3f7fb";
        ctx.fillRect(0, 0, 400, 600);
        ctx.fillStyle = "#1176d6";
        ctx.font = "bold 22px Arial";
        ctx.fillText("EVENT TICKET", 125, 40);
        ctx.fillStyle = "#1c6ef2";
        ctx.font = "bold 17px Arial";
        ctx.fillText("Receipt: " + window.ticketPayload.receiptNum, 20, 80);
        ctx.fillStyle = "#333";
        ctx.font = "16px Arial";
        ctx.fillText("Event: " + window.ticketPayload.event, 20, 120);
        ctx.fillText("Name: " + window.ticketPayload.name, 20, 150);
        ctx.fillText("Phone: " + window.ticketPayload.phone, 20, 180);
        ctx.fillText("Ticket Type: " + window.ticketPayload.type, 20, 210);
        ctx.fillText("Price: K" + window.ticketPayload.price, 20, 240);
        // QR generation
        let tmpQr = document.createElement('div');
        new QRCode(tmpQr, {
            text: JSON.stringify(window.ticketPayload),
            width: 90,
            height: 90,
            colorDark : "#1c6ef2",
            colorLight : "#fff",
            correctLevel : QRCode.CorrectLevel.H
        });
        let qrImg = tmpQr.querySelector('img');
        if (qrImg) {
            let image = new window.Image();
            image.onload = function() {
                ctx.drawImage(image, 270, 260, 90, 90);
                triggerDownload(canvas);
                if (callback) callback();
            };
            image.src = qrImg.src;
        } else {
            triggerDownload(canvas);
            if (callback) callback();
        }
    }
    function triggerDownload(canvas) {
        let link = document.createElement('a');
        link.download = "ticket.png";
        link.href = canvas.toDataURL("image/png");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function bookViaWhatsapp(payload) {
        const message = encodeURIComponent(
            `Hello! With the below details I would like to book this ticket:\n` +
            `Event: ${payload.event}\n` +
            `Name: ${payload.name}\n` +
            `Phone: ${payload.phone}\n` +
            `Ticket Type: ${payload.type}\n` +
            `Price: K${payload.price}\n` +
            `Receipt No: ${payload.receiptNum}\n\n` +
            `Please let me know the next steps.`
        );
        const whatsappNumber = "260974778863";
        window.open(`https://wa.me/${whatsappNumber}?text=${message}`,'_blank');
        generateAndDownloadTicketImage();
    }

    function showConfirmModal() {
        let name = buyerName.value;
        let phone = buyerPhone.value;
        let type = ticketType.value;
        let eventName = document.getElementById("ticketModal").dataset.event;
        // Find event in the list
        let ev = events.find(ev => ev.name === eventName);
        let price = 0;
        if (ev) {
            if(type === "VIP" && ev.vip_single) price = ev.vip_single;
            else if(type === "Ordinary" && ev.ordinary_single) price = ev.ordinary_single;
            else if(type === "Couple" && ev.couple_single) price = ev.couple_single;
            else price = ticketPrices[type] || 0;
        } else {
            price = ticketPrices[type] || 0;
        }
        let receiptNum =
            'NOL-' + new Date().toISOString().slice(0,10).replace(/-/g,"") + '-' +
            Math.floor(1000 + Math.random() * 9000);
        window.ticketPayload = {
            event: eventName,
            name,
            phone,
            type,
            price,
            receiptNum
        };
        document.getElementById("confirmDetails").innerHTML = `
          <div class="receipt-modal-colorful">
            <h3 style="background:#1176d6;color:#fff;padding:5px 0;border-radius:6px 6px 0 0;">EVENT RECEIPT</h3>
            <div style="padding:10px;text-align:left;background:#f3f7fb">
              <strong>Event:</strong> <span style="color:#1c6ef2;">${eventName}</span><br>
              <strong>Name:</strong> ${name}<br>
              <strong>Phone:</strong> ${phone}<br>
              <strong>Ticket Type:</strong> <span style="color:#e26d0b;font-weight:bold;">${type}</span><br>
              <strong>Price:</strong> <span style="color:#f40;font-weight:bold;">K${price}</span><br>
              <strong>Receipt No:</strong> <span style="color:#009966;">${receiptNum}</span>
            </div>
            <div id="ticketQR" class="qr-container"></div>
          </div>
        `;
        setTimeout(() => {
            let qr = document.getElementById("ticketQR");
            qr.innerHTML = "";
            new QRCode(qr, {
                text: JSON.stringify({
                    event: eventName,
                    name: name,
                    phone: phone,
                    type: type,
                    price: price,
                    receiptNum: receiptNum
                }),
                width: 128,
                height: 128,
                colorDark : "#1c6ef2",
                colorLight : "#fff",
                correctLevel : QRCode.CorrectLevel.H
            });
        }, 400);
        closeModal();
        document.getElementById("confirmModal").style.display = "flex";
        document.getElementById('whatsappBookBtn').onclick = function() {
            bookViaWhatsapp(window.ticketPayload);
        };
        generateAndDownloadTicketImage();
    }
    function closeConfirmModal() {
        document.getElementById("confirmModal").style.display = "none";
    }
    const ticketPrices = {
        VIP: 200,
        Ordinary: 100,
        Couple: 170
    };
    window.onclick = function(event) {
        ['ticketModal', 'confirmModal', 'ticketResult'].forEach(function(id) {
            var modal = document.getElementById(id);
            if (event.target == modal) {
                modal.style.display = "none";
            }
        });
    }
    window.onload = loadEvents;
    </script>
</body>
</html>

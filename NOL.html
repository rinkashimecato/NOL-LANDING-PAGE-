<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Upcoming Events | Buy Tickets</title>
    <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        body{
            background: #f8f8f8;
            color: #333;
        }
        header{
            width: 100%;
            background: #fff;
            padding: 15px 8%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: fixed;
            top:0;
            left:0;
            z-index: 100;
        }
        .logo{
            font-size: 22px;
            font-weight: bold;
            color: #111;
        }
        nav a{
            margin-left: 20px;
            text-decoration: none;
            color: #333;
            font-weight: 600;
        }
        .contact-info{
            font-size: 14px;
            color: #444;
        }
        .hero{
            width: 100%;
            height: 75vh;
            background: url('https://images.unsplash.com/photo-1506157786151-b8491531f063') center/cover no-repeat;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 0 10%;
            margin-top: 80px;
        }
        .hero h1{
            color: #fff;
            font-size: 45px;
            margin-bottom: 10px;
            text-shadow: 0 3px 10px rgba(0,0,0,0.4);
        }
        .hero p{
            color: #eee;
            font-size: 18px;
            margin-bottom: 20px;
            text-shadow: 0 2px 6px rgba(0,0,0,0.4);
        }
        .btn{
            padding: 12px 25px;
            background: #ff4d4d;
            color: #fff;
            font-weight: bold;
            border-radius: 8px;
            text-decoration: none;
            transition: 0.2s;
        }
        .btn:hover{
            background: #ff3333;
        }
        .featured{
            width: 100%;
            padding: 50px 8%;
        }
        .featured h2{
            font-size: 28px;
            margin-bottom: 20px;
        }
        .featured-card{
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .featured-card img{
            width: 100%;
            height: 300px;
            object-fit: cover;
        }
        .featured-content{
            padding: 20px;
        }
        .featured-content h3{
            font-size: 24px;
        }
        .featured-content p{
            margin: 8px 0;
            color: #666;
        }
        .event-btns{
            margin-top: 15px;
        }
        .event-btns a{
            padding: 10px 20px;
            background: #111;
            color: #fff;
            margin-right: 10px;
            border-radius: 6px;
            text-decoration: none;
        }
        .events{
            padding: 50px 8%;
        }
        .events h2{
            font-size: 28px;
            margin-bottom: 20px;
        }
        .event-grid{
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, auto));
            gap: 20px;
        }
        .event-card{
            background: #fff;
            padding-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .event-card img{
            width: 100%;
            height: 180px;
            object-fit: cover;
        }
        .event-card .info{
            padding: 15px;
        }
        .ticket-btn{
            background: #ff4d4d;
            padding: 10px 18px;
            display: inline-block;
            color: #fff;
            border-radius: 6px;
            margin-top: 10px;
            text-decoration: none;
            cursor: pointer;
        }
        footer{
            background: #222;
            padding: 30px 8%;
            color: #ccc;
            text-align: center;
            margin-top: 50px;
        }
        .logo img{
            height: 150px;
            width: auto;
            object-fit: contain;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            border-radius: 15px;
            text-align: center;
            position: relative;
        }
        .ticket-banner {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }
        .btn-primary {
            background: #007bff;
            padding: 10px 20px;
            color: white;
            border-radius: 6px;
            border: none;
            margin-top: 10px;
            cursor: pointer;
        }
        .btn-secondary {
            background: #ddd;
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
        }
        .close {
            position: absolute;
            top: 10px;
            right: 25px;
            color: #444;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
        }
        .receipt-modal-colorful {
            box-shadow: 0 4px 25px rgba(17,118,214,0.10);
            background: #fff;
            border-radius:8px;
            margin:6px 0;
            overflow:hidden;
            border: 2px solid #1176d6;
            max-width: 340px;
            margin-left: auto;
            margin-right: auto;
        }
        .receipt-modal-colorful h3 {
            margin:0;
        }
        .receipt-modal-colorful .qr-container {
            text-align:center;
            margin-top:10px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">
            <img src="logo.png" alt="Logo">
        </div>
        <nav>
            <a href="#">Home</a>
            <a href="#">Events</a>
            <a href="#">About</a>
        </nav>
        <div class="contact-info">
            ðŸ“ž +260 97 123 4567  
        </div>
    </header>
    <!-- Hero -->
    <section class="hero">
        <div>
            <h1>Discover & Buy Tickets for Upcoming Events</h1>
            <p>Instant digital tickets. No queues. No stress.</p>
            <a href="#events" class="btn">Browse Events</a>
        </div>
    </section>
    <!-- Featured Event - will be rendered dynamically -->
    <section class="featured" id="featuredSection"></section>
    <!-- Upcoming Events - will be rendered dynamically -->
    <section class="events" id="eventsSection"></section>
    <!-- ================= BUY TICKET MODAL ================= -->
    <div id="ticketModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <img id="ticketBanner" src="" class="ticket-banner" />
            <h2 id="eventNameDisplay"></h2>
            <label>Name:</label>
            <input type="text" id="buyerName">
            <label>Phone Number:</label>
            <input type="text" id="buyerPhone">
            <label>Ticket Type:</label>
            <select id="ticketType">
                <option value="VIP">VIP</option>
                <option value="Ordinary">Ordinary</option>
                <option value="Couple">Couple</option>
            </select>
            <button onclick="showConfirmModal()" class="btn-primary">Continue</button>
        </div>
    </div>
    <!-- ================= CONFIRMATION MODAL ================= -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2>Confirm Your Ticket</h2>
            <div id="confirmDetails"></div>
            <button id="whatsappBookBtn" class="btn-primary">Book via WhatsApp</button>
            <button onclick="closeConfirmModal()" class="btn-secondary">Cancel</button>
        </div>
    </div>
    <!-- ================= TICKET RESULT (IMAGE DOWNLOAD) ================= -->
    <div id="ticketResult" class="modal">
        <div class="modal-content">
            <h2>Your Ticket is Ready</h2>
            <canvas id="ticketCanvas" width="400" height="600" style="border:1px solid #000"></canvas>
            <a id="downloadLink" class="btn-primary" download="ticket.png">Download Ticket</a>
        </div>
    </div>
    <footer>
        NIGHT OF LAUGHTERÂ© 2025 â€¢ All Rights Reserved
    </footer>
    <script>
    // Example using SheetDB.io
    const SHEETDB_API = "https://sheetdb.io/api/v1/owneanfeuzae9"; // Replace YOUR_API_KEY with your actual SheetDB API key
    let events = [];

    // Fetch and render events from SheetDB
    function loadEvents() {
      fetch(SHEETDB_API)
        .then(res => res.json())
        .then(data => {
          events = data; // data is an array of row objects
          renderEvents();
        });
    }

    // Helper: Render the featured and upcoming events
    function renderEvents() {
        // Render Featured Event
        const featured = events.find(ev => ev.type && ev.type.toLowerCase() === "featured");
        document.getElementById("featuredSection").innerHTML = featured ?
        `<h2>Featured Event</h2>
            <div class="featured-card">
                <img src="${featured.image}" />
                <div class="featured-content">
                    <h3>${featured.name}</h3>
                    <p>Date: ${featured.date}</p>
                    <p>Location: ${featured.location}</p>
                    <p>From K${featured.price}</p>
                    <p>${featured.desc || ""}</p>
                    <div class="event-btns">
                        <a href="javascript:void(0);" onclick="openBuyTicket('${featured.name}','${featured.image}')">Buy Ticket</a>
                        <a href="#">More Info</a>
                    </div>
                </div>
            </div>` : '';

        // Render Upcoming Events
        const upcoming = events.filter(ev => ev.type && ev.type.toLowerCase() === "upcoming");
        document.getElementById("eventsSection").innerHTML =
            `<h2>Upcoming Events</h2>
            <div class="event-grid">
                ${upcoming.map(ev =>
                    `<div class="event-card">
                        <img src="${ev.image}">
                        <div class="info">
                            <h3>${ev.name}</h3>
                            <p>${ev.date} â€¢ ${ev.location}</p>
                            <p>From K${ev.price}</p>
                            <a class="ticket-btn" href="javascript:void(0);" onclick="openBuyTicket('${ev.name}','${ev.image}')">Buy Ticket</a>
                        </div>
                    </div>`
                ).join('')}
            </div>`;
    }

    // All previous ticket/booking modal JS follows unchanged
    const ticketPrices = {
        VIP: 200,
        Ordinary: 100,
        Couple: 170
    };
    function openBuyTicket(eventName, image) {
        document.getElementById("ticketModal").style.display = "flex";
        document.getElementById("eventNameDisplay").textContent = eventName;
        document.getElementById("ticketBanner").src = image;
        document.getElementById("buyerName").value = "";
        document.getElementById("buyerPhone").value = "";
        document.getElementById("ticketType").value = "VIP";
        document.getElementById("ticketModal").dataset.event = eventName;
        document.getElementById("ticketModal").dataset.image = image;
    }
    function closeModal() {
        document.getElementById("ticketModal").style.display = "none";
    }
    function showConfirmModal() {
        let name = buyerName.value;
        let phone = buyerPhone.value;
        let type = ticketType.value;
        let eventName = document.getElementById("ticketModal").dataset.event;

        // Try to get the dynamic price from the event list, fallback to type price
        let ev = events.find(ev => ev.name === eventName);
        let price = ev && ev.price ? ev.price : (ticketPrices[type] || 0);

        let receiptNum = 
            'NOL-' + new Date().toISOString().slice(0,10).replace(/-/g,"") + '-' +
            Math.floor(1000 + Math.random() * 9000);
        // Store ticket info for future steps
        window.ticketPayload = {
            event: eventName,
            name,
            phone,
            type,
            price,
            receiptNum
        };
        document.getElementById("confirmDetails").innerHTML = `
          <div class="receipt-modal-colorful">
            <h3 style="background:#1176d6;color:#fff;padding:5px 0;border-radius:6px 6px 0 0;">EVENT RECEIPT</h3>
            <div style="padding:10px;text-align:left;background:#f3f7fb">
              <strong>Event:</strong> <span style="color:#1c6ef2;">${eventName}</span><br>
              <strong>Name:</strong> ${name}<br>
              <strong>Phone:</strong> ${phone}<br>
              <strong>Ticket Type:</strong> <span style="color:#e26d0b;font-weight:bold;">${type}</span><br>
              <strong>Price:</strong> <span style="color:#f40;font-weight:bold;">K${price}</span><br>
              <strong>Receipt No:</strong> <span style="color:#009966;">${receiptNum}</span>
            </div>
            <div id="ticketQR" class="qr-container"></div>
          </div>
        `;
        // Generate the QR code with ticket details
        setTimeout(() => {
            let qr = document.getElementById("ticketQR");
            qr.innerHTML = "";
            new QRCode(qr, {
                text: JSON.stringify({
                    event: eventName,
                    name: name,
                    phone: phone,
                    type: type,
                    price: price,
                    receiptNum: receiptNum
                }),
                width: 128,
                height: 128,
                colorDark : "#1c6ef2",
                colorLight : "#fff",
                correctLevel : QRCode.CorrectLevel.H
            });
        }, 400); // Give DOM time to render confirmDetails
        closeModal();
        document.getElementById("confirmModal").style.display = "flex";

        // Set WhatsApp booking handler
        document.getElementById('whatsappBookBtn').onclick = function() {
            bookViaWhatsapp(window.ticketPayload);
        };
    }
    function closeConfirmModal() {
        document.getElementById("confirmModal").style.display = "none";
    }
    function bookViaWhatsapp(payload) {
        // Compose WhatsApp message text
        const message = encodeURIComponent(
            `Hello! With the below details I would like to book this ticket:\n` +
            `Event: ${payload.event}\n` +
            `Name: ${payload.name}\n` +
            `Phone: ${payload.phone}\n` +
            `Ticket Type: ${payload.type}\n` +
            `Price: K${payload.price}\n` +
            `Receipt No: ${payload.receiptNum}\n\n` +
            `Please let me know the next steps.`
        );
        const whatsappNumber = "260974778863";
        window.open(`https://wa.me/${whatsappNumber}?text=${message}`,'_blank');
    }
    function generateTicketImage() {
        document.getElementById("ticketResult").style.display = "flex";
        let canvas = document.getElementById("ticketCanvas");
        let ctx = canvas.getContext("2d");
        ctx.fillStyle = "#f3f7fb";
        ctx.fillRect(0, 0, 400, 600);
        ctx.fillStyle = "#1176d6";
        ctx.font = "bold 22px Arial";
        ctx.fillText("EVENT TICKET", 125, 40);
        ctx.fillStyle = "#1c6ef2";
        ctx.font = "bold 17px Arial";
        ctx.fillText("Receipt: " + window.ticketPayload.receiptNum, 20, 80);
        ctx.fillStyle = "#333";
        ctx.font = "16px Arial";
        ctx.fillText("Event: " + window.ticketPayload.event, 20, 120);
        ctx.fillText("Name: " + window.ticketPayload.name, 20, 150);
        ctx.fillText("Phone: " + window.ticketPayload.phone, 20, 180);
        ctx.fillText("Ticket Type: " + window.ticketPayload.type, 20, 210);
        ctx.fillText("Price: K" + window.ticketPayload.price, 20, 240);
        let tmpQr = document.createElement('div');
        new QRCode(tmpQr, {
            text: JSON.stringify(window.ticketPayload),
            width: 90,
            height: 90,
            colorDark : "#1c6ef2",
            colorLight : "#fff",
            correctLevel : QRCode.CorrectLevel.H
        });
        let qrImg = tmpQr.querySelector('img');
        if (qrImg) {
            let image = new window.Image();
            image.onload = function() {
                ctx.drawImage(image, 270, 260, 90, 90);
                let link = document.getElementById("downloadLink");
                link.href = canvas.toDataURL("image/png");
            };
            image.src = qrImg.src;
        } else {
            let link = document.getElementById("downloadLink");
            link.href = canvas.toDataURL("image/png");
        }
    }
    window.onclick = function(event) {
        ['ticketModal', 'confirmModal', 'ticketResult'].forEach(function(id) {
            var modal = document.getElementById(id);
            if (event.target == modal) {
                modal.style.display = "none";
            }
        });
    }
    // Load events on page load
    window.onload = loadEvents;
    </script>
</body>
</html>